# Load real session from file
with open("session.json") as f:
    real_session = json.load(f)
    cookies = real_session.get("cookies", [])
    cookies_str = "; ".join([f"{c['name']}={c['value']}" for c in cookies]) if cookies else ""

    # ðŸ”¥ Extract ICPPLUS from page source (not cookies!)
    # The site uses server-side session ID in the HTML (hidden field or URL)
    import requests
    response = requests.get(real_session["url"])
    import re
    icpplus_match = re.search(r"ICPPLUS=([A-Za-z0-9]+)", response.text)
    jsessionid_match = re.search(r"JSESSIONID=([A-Za-z0-9]+)", response.text)
    
    ICPPLUS = icpplus_match.group(1) if icpplus_match else "NOT_FOUND"
    JSESSIONID = jsessionid_match.group(1) if jsessionid_match else "NOT_FOUND"

    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36",
        "Cookie": f"ICPPLUS={ICPPLUS}; JSESSIONID={JSESSIONID}",
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
        "Accept-Language": "es-ES,es;q=0.5",
        "Accept-Encoding": "gzip, deflate",
        "Connection": "keep-alive",
        "Upgrade-Insecure-requests": "1",
    }
    cookies_dict = {"ICPPLUS": ICPPLUS, "JSESSIONID": JSESSIONID}
